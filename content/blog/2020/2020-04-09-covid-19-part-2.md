+++
author = "Robert Cvitkoviƒç"
date = "2020-04-07"
draft = false
title = "Data Mining Covid-19 Epidemics: Part 2"
type = "blog"
thumbImage = "/blog_img/2020/2020-04-09-choropleth.png"
frontPageImage = "/blog_img/2020/2020-04-09-choropleth.png"
categories = ["covid-19", "visualization", "addons", "geo"]
shortExcerpt = "Visualizing Covid-19 data using maps"
longExcerpt = "Visualizing Covid-19 data using maps"
+++

In the privies blog post [Data Mining Covid-19 Epidemics: Part 1](https://orange.biolab.si/blog/2020/2020-04-02-covid-19-basic/) you already learned how to load data from the COVID-19 epidemic and do some basic visualizations. If you haven't already, please check it out before proceeding to read this blog. We assume your hands are already dirty from digging around in Orange.

In this blog we will show how we can use maps in Orange. We will also extend on the "data mining is interactive" concept by creating an animation. This will allow us to visualize both geographic position of countries as well us the change in cases numbers within countries. 

## Prerequisite: installing add-ons

Orange already comes with a great selection of widgets that work with all sorts of data. But sometimes you would like to analyze data that contains some special data types (e.g. text, time, geolocation) that require special widgets. Add-ons to the rescue. Those are packages of widgets specially designed to handle specific data types.

In this blog post we will make use of Orange3-Geo and Orange3-Timeseries add-ones. To install them open Orange than in the top menu select *Options* then *Add-ons*. A new window will appear with the list of officially supported add-ons. Find and select the checkbox for the aforementioned add-ons and click *OK*. After the installation Orange prompts you to restart it. After that you will find new sections in the widget sidebar with great new widgets.

{{% figure src="/blog_img/2020/2020-04-09-install-addon.png" %}}

**Note:** recently there have been some changes in those two add-ons. If you already have them installed please upgrade them to the latest version.

## From Scatter Plot to Geo Map

You should already be familiar with Scatter Plot widget. It does its job but it's hard to know exactly where on earth points lie. Of course you can use labels to add country names, but it would clog up the image and besides you probably don't know every country.

{{% figure src="/blog_img/2020/2020-04-09-scatter-plot.png" %}}

The solution is to use Geo Map from the Orange3-Geo add-on. It provides a variety of maps as backgrounds. With those its much easier to connect points with locations. To start first get our now well known [Covid-19 data](https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv) into Orange by using File widget (remember previous blog post). Then connect File widget with Geo Map. 

{{% sidework src="/blog_img/2020/2020-04-09-workflow-01.png" %}}

You may notice that latitude and longitude attributes are automatically selected. Under them you can find similar point properties as in Scatter Plot. The number of cases is nicely represented by size so select the latest date for *Size*. If you feel adventures you can even change the map type to satellite or topological.

{{% figure src="/blog_img/2020/2020-04-09-full-geomap.png" %}}

You can observe many other similarities with Scatter Plot. You can scroll to zoom and the map gets more detailed. You can drag the mouse to select data points. Now that we have an image of Europe, selecting its countries doesn't seem that difficult anymore.

{{% figure src="/blog_img/2020/2020-04-09-eu-geomap.png" %}}

## The chloro... chorophl... chloropet..., map with areas colored in.

This already looks really nice. But those more or less same sized points on the map represent entire countries from the big Russia to the small Slovenia. It would be much nicer to represent countries by coloring their area which is exactly what Choropleth Map widget does. Let connect it.

{{% sidework src="/blog_img/2020/2020-04-09-workflow-02.png" %}}

This widget is similar to Geo Map just that instead of displaying each data point directly it aggregates them into regions (e.g. Country, State, Province, ...) and displays those instead. Under *Attribute* select the latest date and under *Agg.* select *sum*. The colored regions now show the sum of confirmed covid-19 cases for each country. Now try selecting different dates. You will see how in the beginning there is a lot of growth in China, followed by a period of stagnation. Also we see how in the past week USA overtook all other countries. I guess they just can't let China be better.

{{% figure src="/blog_img/2020/2020-04-09-choropleth.png" %}}

There also seems to be a Warning *7 points are not in any regions*, which can be ignored. Those points are just some small islands and cruise ships which are also included in this data set.

## Image is good, animation is better!

As we saw in the previous example it's nice to observe how countries are doing in different time periods. What would be even better is if this would be done automatically.

To do this we will take advantage of Oranges best features which is its *interactivity*. We will also need some widget kung fu and the help of a special widget from Orange3-Timeseries. More on this add-on and its other widgets will follow in the next blog post. For now the one widget we will use is Time Slice. What this widget does is it selects a section of data according to the set time slice. Even better it can automatically move the time slice and update outputted data. This is exactly what we need for our animation. Unfortunately Time Slice expects the data in a different format which means we need to do some data transformation first.

### Kill Transpose: Volume 1

Lets start again with the File widget that loads our data. To make our work easier down the line lets also set *Lat* and *Long* attributes to meta by double clicking  *feature* in the *Role* column and selecting *meta*. This will tell Orange not to do data manipulation on it.  

{{% tooltippic src="/blog_img/2020/2020-04-09-file.gif" %}}

To make the transformation for Time Slice we will use the Transpose widget. Connect it to File widget.

{{% sidework src="/blog_img/2020/2020-04-09-workflow-03.png" %}}

Set *From variable* to *Country/Region*. A warning will appear telling use that indices where added to variables with the same name. This doesn't affect our workflow so we can ignore it and continue.

{{% tooltippic src="/blog_img/2020/2020-04-09-transpose-1.png" %}}

To better understand what just happened, connect a Data Table after it and see the result. We see a new column *Feature name* and dates in its rows. We can also observe new columns named by countries. What just happened is that rows and columns where interchanged like a transpose on a matrix.

{{% figure src="/blog_img/2020/2020-04-09-table-1.png" %}}

The next step is to transform the type of *Feature name*. Orange currently still thinks that this column contains some text but we need it as time. To do the conversion connect Edit Domain widget. 

{{% sidework src="/blog_img/2020/2020-04-09-workflow-04.png" %}}

Under *Variables* scroll to the bottom and select *Feature name*. Under *Edit* change the type to *Time* and while you are at it change the name to something more meaningful like *date*. Finally click *Apply*

{{% tooltippic src="/blog_img/2020/2020-04-09-edit-domain.gif" %}}

The data is now ready to be ingested into Time Slice. Connect and open it. 

{{% sidework src="/blog_img/2020/2020-04-09-workflow-05.png" %}}

In the top you see the slice of data that is currently on the output. You can move it around or select a new slice. We will manually select a slice of one day ba selecting the 25. and 26. january of 2020. If you clicked on the play button the slice will start to move and the output will start to update. If you don't believe me feel free to connect Data Table and check for yourself. I would just suggest clicking the stop button before proceeding.

{{% tooltippic src="/blog_img/2020/2020-04-09-time-slice.png" %}}

### Kill Transpose: Volume 2

We are almost at the finish line. All we need to do now is to transform the data back into its original layout. To do so connect another Transpose widget.

{{% sidework src="/blog_img/2020/2020-04-09-workflow-06.png" %}}

Under *Future names* select *Generic* which will name the new column *Feature 1*.

{{% tooltippic src="/blog_img/2020/2020-04-09-transpose-2.png" %}}

Lets do a final check of what our data looks like before inserting it into maps. Looks good.

{{% figure src="/blog_img/2020/2020-04-09-table-2.png" %}}

The final step is connecting Choropleth Map, selecting *Feature 1* as *Attribute* and *Sum* as the *Agg.*.

{{% sidework src="/blog_img/2020/2020-04-09-workflow-07.png" %}}

To observe the animation have both Choropleth and Time Slice opened at the same time. Hit play and observe the beauty.

{{% video src="/blog_img/2020/2020-04-09-animation-choropleth.mp4" %}}

Lets do something similar but with Geo Map widget. For an added bonus lets also remove countries that have zero confirmed cases. This will have the effect that the number of points on the map will increase as the virus is spreading throughout the world. To get that connect Select Rows.

{{% sidework src="/blog_img/2020/2020-04-09-workflow-08.png" %}}

Under Conditions select *Feature 1*, *is greater than* and input *0*.

{{% tooltippic src="/blog_img/2020/2020-04-09-select-rows.gif" %}}

To get the best result connect Geo Map and open it. Zoom out so you see the whole world and on the left side check *Freeze map*. This will prevented the mep from jumping around as new points are added.

{{% sidework src="/blog_img/2020/2020-04-09-workflow-09.png" %}}

You can now observe the animation in the same way you did for Choropleth.

{{% video src="/blog_img/2020/2020-04-09-animation-geomap.mp4" %}}

## Where from here?

We learned how to extend Oranges functionality with new widgets from add-ons. We used Orange3-Geo add-on to put Covid-19's numbers on the map. We where also able to create a nice animation showing the change and spread of the virus. This change could be a good indicator of how countries are fighting the epidemic. More on taht and Orange3-Timeseries will follow in the next posts.

---

Orange is a multi-platform open-source machine learning and data visualization tool for beginners and experts alike. [Download Orange](https://orange.biolab.si/download), and load and explore your own data sets!

In addition to a variety of learning materials posted online in the form of [blog posts](https://orange.biolab.si/blog/), [tutorial videos](https://www.youtube.com/playlist?list=PLmNPvQr9Tf-ZSDLwOzxpvY-HrE0yv-8Fy), we've created a [Discord server. Join the community, tell us what you think!](https://discord.gg/FWrfeXV)